name: Build Pin Randomizer Binaries (Manually) - v0.0.0

on:
  workflow_dispatch:

jobs:
  build-windows:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: pip install pyinstaller

      - name: Build EXE
        run: |
          pyinstaller --onefile --noconsole ^
            --icon=pin-randomizer/src/icon.ico ^
            --name=NTM-pin-randomizer-v0.0.0-patcher ^
            pin-randomizer/src/randomize-pins.py

      - uses: actions/upload-artifact@v4
        with:
          name: ntm-pin-randomizer-windows
          path: dist/NTM-pin-randomizer-v0.0.0-patcher.exe

  build-macos:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: pip install pyinstaller pillow

      - name: Build App
        run: |
          pyinstaller --onefile --windowed \
            --icon=pin-randomizer/src/icon.icns \
            --name=NTM-pin-randomizer-v0.0.0-patcher \
            pin-randomizer/src/randomize-pins.py

      - uses: actions/upload-artifact@v4
        with:
          name: ntm-pin-randomizer-macos
          path: dist/NTM-pin-randomizer-v0.0.0-patcher

  build-linux-x64:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: pip install pyinstaller

      - name: Build binary
        run: |
          pyinstaller --onefile --noconsole \
            --icon=pin-randomizer/src/icon.ico \
            --name=NTM-pin-randomizer-v0.0.0-patcher \
            pin-randomizer/src/randomize-pins.py

      - uses: actions/upload-artifact@v4
        with:
          name: ntm-pin-randomizer-linux-x64
          path: dist/NTM-pin-randomizer-v0.0.0-patcher

  build-linux-arm64:
    runs-on: ubuntu-latest
    container: arm64v8/python:3.11-slim
    steps:
      - name: Install build dependencies
        run: apt-get update && apt-get install -y build-essential git zip

      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Install pyinstaller
        run: pip install pyinstaller

      - name: Build binary (ARM64)
        run: |
          pyinstaller --onefile --noconsole \
            --icon=pin-randomizer/src/icon.ico \
            --name=NTM-pin-randomizer-v0.0.0-patcher \
            pin-randomizer/src/randomize-pins.py

      - name: Upload ARM64 binary
        uses: actions/upload-artifact@v4
        with:
          name: ntm-pin-randomizer-linux-arm64
          path: dist/NTM-pin-randomizer-v0.0.0-patcher
